ðŒð®ð¬ð­ ð“ð«ð²: Microsoft (Hard Level) hashtag#SQL Interview Question â€” Solution

Find the total number of downloads for paying and non-paying users by date. Include only records where non-paying customers have more downloads than paying customers. The output should be sorted by earliest date first and contain 3 columns date, non-paying downloads, paying downloads. 

Note: In Oracle you should use "date" when referring to date column (reserved keyword).

ðŸ”By solving this, you'll learn how to use join, groupby and having. Give it a try and share the output!ðŸ‘‡

ð’ðœð¡ðžð¦ðš ðšð§ð ðƒðšð­ðšð¬ðžð­:
CREATE TABLE ms_user_dimension (user_id INT PRIMARY KEY,acc_id INT);
INSERT INTO ms_user_dimension (user_id, acc_id) VALUES (1, 101),(2, 102),(3, 103),(4, 104),(5, 105);

CREATE TABLE ms_acc_dimension (acc_id INT PRIMARY KEY,paying_customer VARCHAR(10));
INSERT INTO ms_acc_dimension (acc_id, paying_customer) VALUES (101, 'Yes'),(102, 'No'),(103, 'Yes'),(104, 'No'),(105, 'No');

CREATE TABLE ms_download_facts (date DATETIME,user_id INT,downloads INT);
INSERT INTO ms_download_facts (date, user_id, downloads) VALUES ('2024-10-01', 1, 10),('2024-10-01', 2, 15),('2024-10-02', 1, 8),('2024-10-02', 3, 12),('2024-10-02', 4, 20),('2024-10-03', 2, 25),('2024-10-03', 5, 18);
-----------SOlution------

select SUM (case when paying_customer='Yes' then downloads ELSE 0 END) as 'Paying_downloads',
SUM(case when paying_customer='No' then downloads ELSE 0 END) as 'NON_Paying_downloads',date
from ms_acc_dimension a join  ms_user_dimension u join ms_download_facts d on a.acc_id=u.acc_id and  u.user_id=d.user_id

group by date having SUM ( CASE WHEN paying_customer='No' THEN downloads else 0 END ) > 
SUM( CASE WHEN paying_customer='Yes'   THEN downloads ELSE 0 END ) ;
